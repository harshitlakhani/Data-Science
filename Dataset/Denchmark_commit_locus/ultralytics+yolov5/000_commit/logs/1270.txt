      opt.img_weights bug fix (#885) 
         model.train()            # Update image weights (optional)         if dataset.image_weights:         if opt.img_weights:              # Generate indices              if rank in [-1, 0]:                 w = model.class_weights.cpu().numpy() * (1 - maps) ** 2  # class weights                 image_weights = labels_to_image_weights(dataset.labels, nc=nc, class_weights=w)                 dataset.indices = random.choices(range(dataset.n), weights=image_weights,                                                  k=dataset.n)  # rand weighted idx                 cw = model.class_weights.cpu().numpy() * (1 - maps) ** 2  # class weights                 iw = labels_to_image_weights(dataset.labels, nc=nc, class_weights=cw)  # image weights                 dataset.indices = random.choices(range(dataset.n), weights=iw, k=dataset.n)  # rand weighted idx              # Broadcast if DDP              if rank != -1:                 indices = torch.zeros([dataset.n], dtype=torch.int)                 if rank == 0:                     indices[:] = torch.tensor(dataset.indices, dtype=torch.int)                 indices = (torch.tensor(dataset.indices) if rank == 0 else torch.zeros(dataset.n)).int()                  dist.broadcast(indices, 0)                  if rank != 0:                      dataset.indices = indices.cpu().numpy() 
