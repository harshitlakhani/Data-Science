      NMS fast mode 
         final_epoch = epoch + 1 == epochs          if not opt.notest or final_epoch:  # Calculate mAP              results, maps, times = test.test(opt.data,                                       batch_size=batch_size,                                       imgsz=imgsz_test,                                       save_json=final_epoch and opt.data.endswith(os.sep + 'coco.yaml'),                                       model=ema.ema,                                       single_cls=opt.single_cls,                                       dataloader=testloader,                                       multi_label=ni > n_burn)                                              batch_size=batch_size,                                              imgsz=imgsz_test,                                              save_json=final_epoch and opt.data.endswith(os.sep + 'coco.yaml'),                                              model=ema.ema,                                              single_cls=opt.single_cls,                                              dataloader=testloader,                                              fast=ni > n_burn)            # Write          with open(results_file, 'a') as f: 
