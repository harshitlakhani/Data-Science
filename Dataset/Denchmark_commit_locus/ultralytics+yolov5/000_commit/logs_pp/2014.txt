profile feature addition profile feature addition cleanup
def time synchronized timesynchronized pytorch accurate pytorchaccurate time torch cuda synchronize torch cuda available isavailable else none return time time def profile ops device torch device cuda torch cuda available isavailable else cpu profile pytorch module list modules example usage torch randn input lambda torch sigmoid silu profile profile speed iterations device requires grad requiresgrad true print torch version device type torch cuda get device properties getdeviceproperties device type cuda else print params flops forward backward input output ops isinstance ops list else ops device hasattr else dtf dtb forward backward try flops thop profile inputs verbose false gflops except flops range time synchronized timesynchronized time synchronized timesynchronized sum backward time synchronized timesynchronized dtf per forward dtb per backward sin tuple shape isinstance torch tensor else list sout tuple shape isinstance torch tensor else list sum list numel parameters isinstance module else parameters print flops dtf dtb str sin str sout def parallel isparallel model return type model parallel data parallel dataparallel parallel distributed data parallel distributeddataparallel
