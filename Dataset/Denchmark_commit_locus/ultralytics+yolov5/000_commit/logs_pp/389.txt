initial commit
import argparse import yaml models common import class detect module def init self anchors detection layer super detect self init self stride none strides computed build self number classes self number outputs per anchor self len anchors number detection layers self len anchors number anchors self grid torch zeros self init grid torch tensor anchors float view self self register buffer registerbuffer anchors shape self register buffer registerbuffer anchor grid anchorgrid clone view self shape self export false onnx export def forward self copy inference output self training self export range self shape view self self permute contiguous self training inference self gridi shape shape self gridi self make grid makegrid device sigmoid self gridi self stridei self anchor gridi anchorgridi append view self return self training else torch cat staticmethod def make grid makegrid torch meshgrid torch arange torch arange return torch stack view float class model module def init self model yaml modelyaml yolovs yaml cfg number classes depth width depthwidth gains super model self init open model yaml modelyaml self yaml load loader yaml full loader fullloader model dict define model self model self save parse model parsemodel self model savelist chout print shape self forward torch zeros build strides anchors self model detect stride torch tensor shape self forward torch zeros forward anchors stride view self stride stride init weights biases torch utils torchutils initialize weights initializeweights self self initialize biases initializebiases run torch utils torchutils model info modelinfo self print def forward self augment false profile false outputs self model previous layer isinstance int else else earlier layers profile import thop thop profile inputs verbose false flops torch utils torchutils time synchronized timesynchronized range torch utils torchutils time synchronized timesynchronized print fms type run append self save else none save output profile print return def initialize biases initializebiases self none initialize biases detect class frequency torch bincount torch tensor concatenate dataset labels long minlength self model detect module zip stride 혻from self modelf bias view conv bias math log obj objects per image math log none else torch log sum cls bias torch parameter view requires grad requiresgrad true def print biases printbiases self self model detect module sorted 혻from self modelf bias detach view conv bias print convd bias mean tolist mean def parse model parsemodel model dict modeldict input channels inputchannels print nssss params module arguments anchors anchors depth multiple depthmultiple width multiple widthmultiple len anchors number anchors number outputs anchors classes layers save layers savelist args enumerate backbone head number module args eval isinstance str else eval strings enumerate args try argsj eval isinstance str else eval strings except pass max round else depth gain convd conv bottleneck spp conv dwconv mix convd mixconvd focus conv plus convplus bottleneck csp bottleneckcsp bottleneck cspf bottleneckcspf bottleneck light bottlenecklight chf args normal args channel expansion factor exponential default math log math log int focus make divisible makedivisible else experimental args channel expansion factor exponential default math log math log level int focus make divisible makedivisible else args args bottleneck csp bottleneckcsp bottleneck cspf bottleneckcspf args elif batch normd batchnormd args chf elif concat sum chx elif origami chf elif detect list reversed else enumerate else chf sequential args range else args module str replace main module type sum numel parameters number params type attach index index type number params print sss args print save extend isinstance int else append savelist layers append append return sequential layers sorted save name main parser argparse argument parser argumentparser parser add argument addargument cfg type str default yolovs yaml help model yaml parser add argument addargument device default help cuda device cpu opt parser parse args parseargs opt cfg glob glob opt cfg recursive true find file device torch utils torchutils select device selectdevice opt device create model model model opt cfg device model train profile img torch rand torch cuda available isavailable else device model img profile true print shape shape onnx export model model export true torch onnx export model img replace yaml onnx verbose true opset version opsetversion tensorboard torch utils tensorboard import summary writer summarywriter writer tbwriter summary writer summarywriter print run tensorboard logdir models runs view tensorboard http localhost writer tbwriter add graph addgraph model model img add model tensorboard writer tbwriter add image addimage test img dataformats cwh add model tensorboard
