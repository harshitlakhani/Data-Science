add include torchscript onnx coreml argument allow users skip exporting formats care correct comments update export renamed skip format skipformat exclude switched format exclude include instructed glenn jocher glennjocher cleanup authored coauthoredby glenn jocher
print colorstr torch pytorch starting opt weights file size filesize opt weights torch script torchscript export prefix colorstr torch script torchscript try print prefix starting export torch torch version opt weights replace torchscript filename torch jit trace model img strict false optimize mobile optimizeformobile opt optimize else save print prefix export success saved file size filesize except exception print prefix export failure torchscript opt include coreml opt include prefix colorstr torch script torchscript try print prefix starting export torch torch version opt weights replace torchscript filename torch jit trace model img strict false optimize mobile optimizeformobile opt optimize else save print prefix export success saved file size filesize except exception print prefix export failure onnx export prefix colorstr onnx try import onnx print prefix starting export onnx onnx version opt weights replace onnx filename torch onnx export model img verbose false opset version opsetversion input names inputnames images dynamic axes dynamicaxes images batch height width size output batch opt dynamic else none checks model onnx modelonnx onnx load load onnx model onnx checker check model checkmodel model onnx modelonnx check onnx model print onnx helper printable graph printablegraph model onnx modelonnx graph print simplify opt simplify try check requirements checkrequirements onnx simplifier onnxsimplifier import onnxsim print prefix simplifying onnx simplifier onnxsimplifier onnxsim version model onnx modelonnx check onnxsim simplify model onnx modelonnx dynamic input shape dynamicinputshape opt dynamic input shapes inputshapes images list img shape opt dynamic else none assert check assert check failed onnx save model onnx modelonnx except exception print prefix simplifier failure print prefix export success saved file size filesize except exception print prefix export failure onnx opt include prefix colorstr onnx try import onnx print prefix starting export onnx onnx version opt weights replace onnx filename torch onnx export model img verbose false opset version opsetversion input names inputnames images dynamic axes dynamicaxes images batch height width size output batch opt dynamic else none checks model onnx modelonnx onnx load load onnx model onnx checker check model checkmodel model onnx modelonnx check onnx model print onnx helper printable graph printablegraph model onnx modelonnx graph print simplify opt simplify try check requirements checkrequirements onnx simplifier onnxsimplifier import onnxsim print prefix simplifying onnx simplifier onnxsimplifier onnxsim version model onnx modelonnx check onnxsim simplify model onnx modelonnx dynamic input shape dynamicinputshape opt dynamic input shapes inputshapes images list img shape opt dynamic else none assert check assert check failed onnx save model onnx modelonnx except exception print prefix simplifier failure print prefix export success saved file size filesize except exception print prefix export failure core coreml export prefix colorstr core coreml try import coremltools print prefix starting export coremltools version model convert inputs image type imagetype name image shape img shape scale bias opt weights replace mlmodel filename model save print prefix export success saved file size filesize except exception print prefix export failure coreml opt include prefix colorstr core coreml try import coremltools print prefix starting export coremltools version model convert inputs image type imagetype image shape img shape scale bias opt weights replace mlmodel filename model save print prefix export success saved file size filesize except exception print prefix export failure finish print export nexport complete time time visualize https github com lutzroeder netron
