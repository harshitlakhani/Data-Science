utils reorganization utils reorganization add new utils files cleanup simplify reduce datasets remove evolve load webcam loadwebcam cleanup
print optimizer stripped fmb saved else def coco class count cococlasscount path coco labels train histogram occurrences per class number classes zeros dtype int files sorted glob glob path file enumerate files labels loadtxt file dtype float reshape bincount labels astype int minlength print len files def coco people cocoonlypeople path coco labels train utils general import coco people cocoonlypeople find images people files sorted glob glob path file enumerate files labels loadtxt file dtype float reshape labels print labels shape file def crop images random cropimagesrandom path images scale utils general import crop images random cropimagesrandom crops images random squares scale fraction warning overwrites images file tqdm sorted glob glob path img imread file bgr img none img shape create random mask minimum size pixels mask maskh random randint int max scale mask height mask maskw mask maskh mask width box xmin max random randint mask maskw ymin max random randint mask maskh xmax min xmin mask maskw ymax min ymin mask maskh apply random color mask imwrite file imgymin ymax xmin xmax def coco single class labels cocosingleclasslabels path coco labels train label class labelclass makes single class singleclass coco datasets utils general import coco single class labels cocosingleclasslabels path exists new shutil rmtree new delete output folder makedirs new make new output folder makedirs new labels makedirs new images file tqdm sorted glob glob path open file labels array split read splitlines dtype float labels label class labelclass img file imgfile file replace labels images replace txt jpg labels reset class open new images txt add image dataset list write img file imgfile open new labels path file name write label labelsi write tuple shutil copyfile src img file imgfile dst new images path file name replace txt jpg copy images def kmean anchors kmeananchors path data coco yaml img size imgsize thr gen verbose true creates kmeans evolved kmeansevolved anchors training dataset arguments path path dataset yaml loaded dataset number anchors img size imgsize image size used training thr anchor label anchorlabel ratio threshold hyperparameter hyp anchor anchort used training default gen generations evolve anchors using genetic algorithm return kmeans evolved anchors usage utils general import kmean anchors kmeananchors thr thr def metric compute metrics none none knone torch min min ratio metric iou whiou torch tensor iou metric return max best bestx def fitness mutation fitness best metric torch tensor dtype torch float return best best thr float mean fitness def print results printresults knp argsort prod sort small large best metric bpr aat best thr float mean thr float mean best possible recall anch thr print thr best possible recall anchors past thr thr bpr aat print img size imgsize metric metricall mean fmean best past thr pastthr mean fmean img size imgsize mean best mean thr mean end enumerate print round round end filter pixels kmeans calculation print running kmeans anchors points len std sigmas whitening dist kmeans iter points mean distance torch tensor dtype torch float filtered torch tensor dtype torch float unfiltered print results printresults plot none none tqdm range kmeans points mean distance fig plt subplots figsize ravel plot arange array marker fig plt subplots figsize plot hist whwh copy pbar desc evolving anchors genetic algorithm fitness verbose print results printresults return print results printresults def print mutation printmutation hyp results yaml file yamlfile hyp evolved hypevolved yaml bucket print mutation results evolve txt use train evolve len hyp tuple hyp keys hyperparam keys
