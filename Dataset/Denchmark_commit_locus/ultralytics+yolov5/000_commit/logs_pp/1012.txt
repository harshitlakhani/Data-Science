label caching foundational write rewrite
self imgsi nbytes pbar desc caching images fgb detect corrupted images https medium com joelthchao programmatically detect corrupted image cbcd programmaticallydetectcorruptedimagecbcd detect corrupted images detectcorruptedimages false detect corrupted images detectcorruptedimages skimage import conda install conda forge condaforge scikit image scikitimage file tqdm self img files imgfiles desc detecting corrupted images try imread file except print corrupted image detected file def cache labels cachelabels self path labels cache cache dataset labels check images read shapes dict pbar tqdm zip self img files imgfiles self label files labelfiles desc scanning images total len self img files imgfiles img label pbar try image image open img image verify pil verify imread img skimage verify skimage import shape exif size exifsize image image size path isfile label open label array split read splitlines dtype float labels len zeros dtype float ximg shape except exception ximg none print warning img hash get hash gethash self label files labelfiles self img files imgfiles torch save path save next time return def len self return len self img files imgfiles
