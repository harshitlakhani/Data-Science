add focal loss qfocalloss update loss implement quality focal loss general case focal loss detail https arxiv org abs obj loss case cls loss label smooth targets long barely case normal focal loss work accurately quality focal loss behave focal loss target equal work accurately targets example targets tensor pred prob predprob tensor focal loss focalloss tensor qfocal loss qfocalloss tensor see targets almost pred prob predprob targets greater pred prob predprob however focal loss larger focal loss purpose focal loss quality focal loss implement case targets equal update loss
return loss sum else none return loss class focal loss qfocalloss module wraps quality focal loss around existing loss fcn lossfcn criteria focal loss focalloss bce logits loss bcewithlogitsloss gamma def init self loss fcn lossfcn gamma alpha super focal loss qfocalloss self init self loss fcn lossfcn loss fcn lossfcn must bce logits loss bcewithlogitsloss self gamma gamma self alpha alpha self reduction loss fcn lossfcn reduction self loss fcn lossfcn reduction none required apply element def forward self pred true loss self loss fcn lossfcn pred true pred prob predprob torch sigmoid pred prob logits alpha factor alphafactor true self alpha true self alpha modulating factor modulatingfactor torch abs true pred prob predprob self gamma loss alpha factor alphafactor modulating factor modulatingfactor self reduction mean return loss mean elif self reduction sum return loss sum else none return loss def compute loss computeloss targets model predictions targets model
