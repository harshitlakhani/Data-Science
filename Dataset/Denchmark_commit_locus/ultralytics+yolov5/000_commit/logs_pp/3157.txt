utils reorganization utils reorganization add new utils files cleanup simplify reduce datasets remove evolve load webcam loadwebcam cleanup
plotting utils import glob import math import import random copy import copy pathlib import path import import matplotlib import matplotlib pyplot plt import numpy import torch import yaml pil import image scipy signal import butter filtfilt utils general import xywhxyxy xyxyxywh utils metrics import fitness def color list colorlist return first plt colors https stackoverflow com questions python color name rgb pythonfromcolornametorgb def hexrgb return tuple int return hexrgb plt params rcparams axes prop cycle propcycle key bykey color def histd histogram used labels png evolve png xedges yedges linspace min max linspace min max hist xedges yedges histogramd xedges yedges xidx clip digitize xedges hist shape yidx clip digitize yedges hist shape return log histxidx yidx def butter lowpass filtfilt butterlowpassfiltfilt data cutoff order https stackoverflow com questions filter smooth scipy numpy howtofiltersmoothwithscipynumpy def butter lowpass butterlowpass cutoff order nyq normal cutoff normalcutoff cutoff nyq return butter order normal cutoff normalcutoff btype low analog false butter lowpass butterlowpass cutoff order order return filtfilt data forward backward forwardbackward filter def plot one box plotonebox img color none label none line thickness linethickness none plots one bounding box image img line thickness linethickness round img shape img shape line font thickness color color random randint range int int int int rectangle img color thickness line type linetype lineaa label max font thickness size tsize get text size gettextsize label font scale fontscale thickness size tsize size tsize rectangle img color lineaa filled put text puttext img label thickness line type linetype lineaa def plot methods plotwhmethods utils general import plot methods plotwhmethods compares two methods width height widthheight anchor multiplication https github com ultralytics yolov issues arange exp torch sigmoid torch numpy fromnumpy numpy fig plt figure figsize dpi plt plot label yol yolov plt plot label yol yolov plt plot label yol yolov plt xlim left right plt ylim bottom top plt xlabel input plt ylabel output plt grid plt legend fig tight layout tightlayout fig savefig comparison png dpi def output target outputtotarget output width height convert model output target format batch batchid class classid conf isinstance output torch tensor output output cpu numpy targets enumerate output none pred box pred box box width box box height box width box height conf pred cls int pred targets append cls conf return array targets def plot images plotimages images targets paths none fname images jpg names none max size maxsize max subplots maxsubplots plot image grid labels isinstance images torch tensor images images cpu float numpy isinstance targets torch tensor targets targets cpu numpy normalise unnormalise max images image targets imagetargets targetstargets boxes xywhxyxy image targets imagetargets classes image targets imagetargets astype int labels image targets imagetargets shape labels conf column conf none labels else image targets imagetargets check confidence presence label pred boxes boxes block blockx boxes boxes block blocky box enumerate boxes cls int classesj color colorscls len colors cls namescls names else cls labels confj conf thresh label cls labels else cls confj plot one box plotonebox box mosaic label label color color line thickness linethickness draw image filename labels paths none label path basename pathsi trim char size tsize get text size gettextsize label font scale fontscale thickness put text puttext mosaic label block blockx block blocky size tsize thickness line type linetype lineaa image border rectangle mosaic block blockx block blocky block blockx block blocky thickness fname none min max ratio limit image size mosaic resize mosaic int int interpolation interarea imwrite fname cvt color cvtcolor mosaic colorbgrrgb save image fromarray mosaic save fname pil save return mosaic def plot scheduler plotlrscheduler optimizer scheduler epochs save dir savedir plot simulating training full epochs optimizer scheduler copy optimizer copy scheduler modify originals range epochs scheduler step append optimizer param groups paramgroups plt plot label plt xlabel epoch plt ylabel plt grid plt xlim epochs plt ylim plt tight layout tightlayout plt savefig path save dir savedir png dpi def plot test txt plottesttxt utils general import plot test plottest plot test txt histograms loadtxt test txt dtype float box xyxyxywh box box fig plt subplots figsize tight layout tightlayout true histd bins cmax cmin set aspect setaspect equal plt savefig histd png dpi fig plt subplots figsize tight layout tightlayout true hist bins hist bins plt savefig histd png dpi def plot targets txt plottargetstxt utils general import plot targets txt plottargetstxt plot targets txt histograms loadtxt targets txt dtype float targets targets width targets height targets fig plt subplots figsize tight layout tightlayout true ravel range axi hist bins label mean std axi legend axi set title settitle plt savefig targets jpg dpi def plot study txt plotstudytxt study txt none utils general import plot study txt plotstudytxt plot study txt generated test fig plt subplots figsize tight layout tightlayout true ravel fig plt subplots figsize tight layout tightlayout true study study coco yolovs studycocoyolovs txt loadtxt dtype float usecols ndmin arange shape none else array map map inference tinference img nms tnms img total ttotal img range axi plot linewidth markersize axi set title settitle argmax plot linewidth markersize label path stem replace study coco studycoco replace yolo yolo plot array linewidth markersize alpha label efficient det efficientdet grid set xlim setxlim set ylim setylim set yticks setyticks arange set xlabel setxlabel gpu speed img set ylabel setylabel coco val legend loc lower right plt savefig study map latency studymaplatency png dpi plt savefig replace txt png dpi def plot labels plotlabels labels save dir savedir plot dataset labels labels labels transpose classes boxes int max number classes fig plt subplots figsize tight layout tightlayout true ravel hist bins linspace rwidth set xlabel setxlabel classes scatter histd cmap jet set xlabel setxlabel set ylabel setylabel scatter histd cmap jet set xlabel setxlabel width set ylabel setylabel height plt savefig path save dir savedir labels png dpi plt close seaborn correlogram try import seaborn sns import pandas data frame dataframe transpose columns width height sns pairplot corner true diag kind diagkind hist kind scatter markers plot kws plotkws dict edgecolor none linewidth alpha diag kws diagkws dict bins plt savefig path save dir savedir labels correlogram labelscorrelogram png dpi plt close except exception pass def plot evolution plotevolution yaml file yamlfile data hyp finetune yaml utils general import plot evolution plotevolution plot hyperparameter evolution results evolve txt open yaml file yamlfile hyp yaml load loader yaml full loader fullloader loadtxt evolve txt ndmin fitness weights min weighted results plt figure figsize tight layout tightlayout true matplotlib font size enumerate hyp items weights sum weights sum best weighted result argmax best single result plt subplot plt scatter histd cmap viridis alpha edgecolors none plt plot max markersize plt title fontdict size limit characters plt yticks print plt savefig evolve png dpi print plot nplot saved evolve png def plot results overlay plotresultsoverlay start stop utils general import plot results overlay plotresultsoverlay plot training results txt overlaying train val losses train train train precision map val val val recall map legends box objectness classification apf mapf titles sorted glob glob results txt glob glob downloads results txt results loadtxt usecols ndmin results shape number rows range start min stop stop else fig plt subplots figsize tight layout tightlayout true ravel range resultsj axi plot marker label smooth ysmooth butter lowpass filtfilt butterlowpassfiltfilt axi plot gradient smooth ysmooth marker label axi set title settitle axi legend axi set ylabel setylabel else none add filename fig savefig replace txt png dpi def plot results plotresults start stop bucket labels save dir savedir utils general import plot results plotresults save dir savedir runs train exp plot training results txt seen https github com ultralytics yolovreproduce training yolovreproduceourtraining fig plt subplots figsize ravel box objectness classification precision recall val box val objectness val classification map map bucket system storage googleapis com files https storage googleapis com resultsg txt bucket files resultsg txt gsutil len files tuple resultsg txt bucket system else files glob glob str path save dir savedir results txt glob glob downloads results txt assert len files results txt files found nothing plot path abspath save dir savedir enumerate files try results loadtxt usecols ndmin results shape number rows range start min stop stop else range resultsi nan show zero loss values normalize label labelsfi len labels else path stem axi plot marker label label linewidth markersize axi set title settitle share train val loss axes axi get shared yaxes getsharedyaxes join axi axi except exception print warning plotting error fig tight layout tightlayout legend fig savefig path save dir savedir results png dpi
