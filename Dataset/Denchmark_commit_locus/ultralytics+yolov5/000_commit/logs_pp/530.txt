use multi threading multithreading cache labels cachelabels use multi threading cache labels cachelabels pep reformat add num threads numthreads changed thread pool threadpool imap unordered imapunordered pool imap unordered imapunordered remove inplace additions update datasets refactor initial desc authored coauthoredby glenn jocher
def cache labels cachelabels self path path labels cache prefix cache dataset labels check images read shapes dict number missing found empty duplicate pbar tqdm zip self img files imgfiles self label files labelfiles desc scanning images total len self img files imgfiles file imfile file lbfile enumerate pbar try verify images image open file imfile verify pil verify shape exif size exifsize image size segments instance segments assert shape shape image size shape segment classes array dtype float segments array dtype float reshape cls concatenate classes reshape segmentsboxes segments cls xywh array dtype float len assert shape labels require columns assert negative labels assert non normalized nonnormalized bounds coordinate labels assert unique axis shape shape duplicate labels else label empty zeros dtype float else label missing zeros dtype float xim file ximfile shape segments except exception logging info prefix warning ignoring corrupted image label file imfile pbar desc prefix scanning path parent path stem images labels found missing empty corrupted number missing found empty corrupt desc prefix scanning path parent path stem images labels pool num threads numthreads pool pbar tqdm pool imap unordered imapunordered verify image label verifyimagelabel zip self img files imgfiles self label files labelfiles repeat prefix desc desc total len self img files imgfiles file imfile shape segments nmf nff nef ncf pbar file imfile xim file ximfile shape segments nmf nff nef ncf pbar desc desc found missing empty corrupted pbar close logging info prefix warning labels found path see help url helpurl hash get hash gethash self label files labelfiles self img files imgfiles results results len self img files imgfiles version cache version try torch save path save cache next time
