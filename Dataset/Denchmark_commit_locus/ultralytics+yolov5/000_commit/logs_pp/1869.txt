torch cuda synchronize update torch cuda synchronize update torch cuda synchronize update torch cuda synchronize update newline
speed reproducibility speedreproducibility tradeoff https pytorch org docs stable notes randomness html torch manual seed manualseed seed seed slower reproducible cudnn deterministic true cudnn benchmark false cudnn benchmark cudnn deterministic false true else faster less reproducible cudnn deterministic false cudnn benchmark true cudnn benchmark cudnn deterministic true false def select device selectdevice device batch size batchsize none device cpu cpu request cpurequest device lower cpu device cpu request cpurequest device requested cpu using torch torch version string cpu device lower cpu cpu environ cudavisibledevices force torch cuda available isavailable false elif device non cpu noncpu device requested environ cudavisibledevices device set environment variable assert torch cuda available isavailable cuda unavailable invalid device device requested check availablity assert torch cuda available isavailable cuda unavailable invalid device device requested check availability cuda false cpu request cpurequest else torch cuda available isavailable cuda torch cuda available isavailable cpu cuda bytes torch cuda device count devicecount batch size batchsize check batch size batchsize compatible device count devicecount assert batch size batchsize batch size batchsize batch size batchsize multiple gpu count torch cuda get device properties getdeviceproperties range using torch torch version enumerate device split len logger info cuda name total memory totalmemory torch cuda device count devicecount batch size batchsize check batch size batchsize compatible device count devicecount assert batch size batchsize batch size batchsize batch size batchsize multiple gpu count space len enumerate device split device else range torch cuda get device properties getdeviceproperties else space cuda name total memory totalmemory bytes else logger info using torch torch version cpu cpu logger info skip line logger info skip line return torch device cuda cuda else cpu def time synchronized timesynchronized pytorch accurate pytorchaccurate time torch cuda synchronize torch cuda available isavailable else none torch cuda available isavailable torch cuda synchronize return time time
