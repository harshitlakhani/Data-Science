git hub github api rate limit fix
def gsutil getsize gsutilgetsize url bucket file size https cloud google com storage docs gsutil commands subprocess check output checkoutput gsutil url shell true decode utf subprocess check output checkoutput gsutil url shell true decode utf return eval split len else bytes def attempt download attemptdownload weights attempt download pretrained weights found locally weights str weights strip replace file path weights name lower msg weights missing try downloading https github com ultralytics yolov releases response requests get https api github com repos ultralytics yolov releases latest json github api assets name response assets release assets yolovs yolovm redundant false second download option file assets path isfile weights try git hub github tag response tag name tagname url https github com ultralytics yolov releases download tag file print downloading url weights torch hub download url file downloadurltofile url weights assert path exists weights path getsize weights check except exception gcp print download error assert redundant secondary mirror url https storage googleapis com ultralytics yolov ckpt file print downloading url weights system curl url weights torch hub download url file downloadurltofile url weights finally path exists weights path getsize weights check remove weights path exists weights else none remove partial downloads print error download failure msg print return def gdrive download gdrivedownload zjhtm tyhntwc aej uxu tipfzjhtmtyhntwczyeeaejouxutm name tmp zip def attempt download attemptdownload file attempt file download exist file path str file strip replace lower file exists response requests get https api github com repos ultralytics yolov releases latest json github api assets name response assets release assets yolovs yolovm name file name name assets msg file missing try downloading https github com ultralytics yolov releases redundant false second download option try git hub github tag response tag name tagname url https github com ultralytics yolov releases download tag name print downloading url file torch hub download url file downloadurltofile url file assert file exists file stat size stsize check except exception gcp print download error assert redundant secondary mirror url https storage googleapis com ultralytics yolov ckpt name print downloading url file system curl url file torch hub download url file downloadurltofile url weights finally file exists file stat size stsize system curl cookie drive google com export downloadid path exists cookie large file curl cookie drive google com export downloadconfirm sid get token gettoken name curl cookie drive google com export downloadconfirm get token gettoken file else small file curl drive google com export downloadid name curl file drive google com export downloadid system execute capture return remove cookie path exists cookie else none cookie unlink missing missingok true remove existing cookie error check remove name path exists name else none remove partial file unlink missing missingok true remove partial print download error raise exception download error return unzip archive name endswith zip file suffix zip print unzipping end system unzip name unzip remove name remove zip free space system unzip file unzip file unlink remove zip free space print done time time print done time time return
